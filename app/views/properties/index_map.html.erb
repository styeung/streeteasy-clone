<h2>Listings</h2>

<h3>Search terms</h3>
<ul>
	<% params["property"].each do |attribute, value| %>
		<% unless value == "" %>
			<li><b><%= attribute.capitalize %></b>: <%= value %></li>
		<% end %>
	<% end %>
</ul>

<ul class="all-properties">
	<% @properties.each do |property| %>
		<li data-lat="<%= property.latitude %>" 
				data-lng="<%= property.longitude %>"
				data-address="<%= property.address.split(" ").map(&:capitalize).join(" ") %>"
				data-price="<%= number_to_currency(property.price) %>"
				data-link="<%= property_url(property) %>">
		</li>
	<% end %>
</ul>

<hr>

<div class="map-container">
	<div id="map" class="map-view"></div>
</div>

<script>

L.mapbox.accessToken = 'pk.eyJ1Ijoic2FpdG95ZXVuZyIsImEiOiJPOXA3aUowIn0.spWqAgo8-BgTGtYiLbOztg';
var map = L.mapbox.map('map', 'saitoyeung.jbj6oj44');
var geocoder = L.mapbox.geocoder('mapbox.places-v1');
var defaultLat = 40.714728;
var defaultLng = -73.998672;

map.setView([defaultLat, defaultLng], 12);

	$(document).ready( function() {
		//want default on first property on page
		$(".all-properties").children().each( function() {
			var lat = $(this).attr("data-lat");
			var lng = $(this).attr("data-lng");
			var address = $(this).attr("data-address");
			var price = $(this).attr("data-price");
			var link = $(this).attr("data-link")
			if(lat && lng) {
				// var popupContent = "<p>hello</p>"
				var popupContent = "<ul><li><a href='" + link + "'>" + address + "</a><p>" + price + "</p></li></ul>";
				// marker.bindPopup(popupContent);
				var marker = L.marker([lat, lng]).bindPopup(popupContent).addTo(map);

			}
		});
		
		// console.log(childrenArray[0].attr("data-lat"));
		$(".main").on("mouseenter", "li.property-listing", function(event) {
			lat = $(event.currentTarget).attr("data-lat");
			lng = $(event.currentTarget).attr("data-lng");
		
			if(lat && lng) {
				map.setView([lat, lng], 15);
				L.marker([lat, lng]).addTo(map);
			}
			else {
				map.setView([defaultLat, defaultLng], 12);
			}
		});
	});
</script>