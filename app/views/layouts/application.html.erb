<!DOCTYPE html>
<html>
<head>
  <title>StreetEasyClone</title>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <%= csrf_meta_tags %>
	<script src='https://api.tiles.mapbox.com/mapbox.js/v2.0.1/mapbox.js'></script>
	<link href='https://api.tiles.mapbox.com/mapbox.js/v2.0.1/mapbox.css' rel='stylesheet' />
	<script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js'></script>
	<link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css' rel='stylesheet' />
	<link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css' rel='stylesheet' />
	<style>
		body { margin:0; padding:0; }
		
	</style>
</head>
<body>
<a href="<%= root_url %>"><h1>StreetEasy</h1></a>
<% if !signed_in? %>
  <a href="<%= new_user_url %>">Sign Up</a> |
  <a href="<%= new_session_url %>">Sign In</a>
<% else %>
  Welcome <a href="<%= user_url(current_user) %>"><%= current_user.email %></a> | Not you? <%= button_to "Sign out", session_url, method: :delete %>
<% end %>

<% if flash[:errors] %>
  <ul>
    <% flash[:errors].each do |error| %>
      <li><%= error %></li>
    <% end %>
  </ul>
<% end %>

<div class="main"></
	<%= yield %>
</div>

<div id="map"></div>

<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script>
	L.mapbox.accessToken = 'pk.eyJ1Ijoic2FpdG95ZXVuZyIsImEiOiJPOXA3aUowIn0.spWqAgo8-BgTGtYiLbOztg';
	var map = L.mapbox.map('map', 'saitoyeung.jbj6oj44');
	var geocoder = L.mapbox.geocoder('mapbox.places-v1');
	
	map.setView([40.834854, -73.939711], 15);
	
	var address, borough, queryString, queryResult, lat, lng
	$(document).ready( function() {
		//want default on first property on page
		$(".main").on("mouseenter", "li.property-listing", function(event) {
			address = $(event.currentTarget).find("a").html();
			borough = $(event.currentTarget).find("li.borough-index").html().slice(9);
			queryString = address + " " + borough + ", New York, NY";
			
			geocoder.query(queryString, function(err, data) {
				lat = data.latlng[0]
				lng = data.latlng[1]
				map.setView([lat, lng], 15);
				L.marker([lat, lng]).addTo(map);
			});
		});
		
		$(".main").on("mouseleave", "li.property-listing", function(event) {
			map.removeLayer(L.marker);
		});
	});
	
</script>
</body>
</html>
