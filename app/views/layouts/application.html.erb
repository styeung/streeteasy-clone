<!DOCTYPE html>
<html>
<head>
  <title>StreetEasyClone</title>
  <%= stylesheet_link_tag    'application', media: 'all'%>
  <%= javascript_include_tag 'application'%>
  <%= csrf_meta_tags %>
	<script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js'></script>

</head>
<body>
<header class="nav">
	<div class="nav-logo">
		<ul class="group">
			<li>
				<a href="/#" class="logo-link"><h1>STREETEASY CLONE</h1></a>
			</li>
		</ul>
	</div>
<% if !signed_in? %>
	<div class="nav-settings">
		<ul class="group">
			<li>
				<a href="#" class="settings-link">Sign In</a>
				<!-- <a href="<%= new_session_url %>" class="settings-link">SIGN IN</a> -->
			</li>
			<li>
				<a href="#" class="register-link">REGISTER (IT'S FREE)</a>
			  <!-- <a href="<%= new_user_url %>" class="register-link">REGISTER(IT'S FREE)</a> | -->
			</li>
		</ul>
	</div>
<% else %>
	<div class="nav-settings">
		<ul class="group">
			<li>
				<a href="#/property/new" class="new-property-link">Add a new property</a>
			</li>
			<li>
			  <a href="<%= user_url(current_user) %>" class="settings-link"><%= current_user.email %></a>
			</li>
			<li>
				<%= link_to "Sign out", session_url, method: :delete %>
			</li>
		</ul>
	</div>
<% end %>

<% if flash[:errors] %>
  <ul>
    <% flash[:errors].each do |error| %>
      <li><%= error %></li>
    <% end %>
  </ul>
<% end %>
</header>
<div class="main">
	<%= yield %>
</div>

<section id="sign-in">
	<article>
		<header>
			<button class="sign-in-cancel">CANCEL</button>
			<h3>Sign In</h3>
		</header>
		<div class="sign-in-body">
			<p>Register for free to access all StreetEasy has to offer including premium data and advanced features.</p>
			<div class="switch-button-container">
				<ul class="group">
					<li class="register-view"><button class="signin-switch">REGISTER</button></li>
					<li class="signin-view"><button class="signin-switch">SIGN IN</li>
				</ul>
			</div>
			<form action="<%= session_url %>" method="POST">
				<%= auth_token %>
				<input type="text" name="user[email]" placeholder="Email Address" class="modal-input">
				<input type="password" name="user[password]" placeholder="Password" class="modal-input">
				<button class="sign-in-button">SIGN IN</button>
			</form>
		</div>
	</article>
</section>

<script template="application/json" id="bootstrapped-current-user">
	<%= current_user.nil? ? false : current_user.id %>
</script>

<script template="application/json" id="bootstrapped-all-neighborhoods">
	<%= all_neighborhoods.to_json.html_safe %>
</script>

<script template="application/json" id="bootstrapped-all-addresses">
	<%= all_addresses.to_json.html_safe %>
</script>

<script template="application/json" id="bootstrapped-all-apt-types">
	<%= all_apt_types.to_json.html_safe %>
</script>


<script>
	$(document).ready(function() {
		
		StreetEasyClone.neighborhoods = JSON.parse($("script#bootstrapped-all-neighborhoods").html());
		StreetEasyClone.apt_types = JSON.parse($("script#bootstrapped-all-apt-types").html());
		StreetEasyClone.addresses = JSON.parse($("script#bootstrapped-all-addresses").html());
		StreetEasyClone.currentUser = JSON.parse($("script#bootstrapped-current-user").html());
		StreetEasyClone.initialize();
		
		$(".settings-link").on("click", function(event) {
			event.preventDefault();
			$("#sign-in").toggleClass("is-active");
		});
		
		$(".sign-in-cancel").on("click", function(event) {
			event.preventDefault();
			$("#sign-in").toggleClass("is-active");
		});
		
    $("#sign-in").on("click", function(event){
      if(event.target.id == this.id){
        event.preventDefault();
        $("#sign-in").removeClass("is-active");
      }
    });
	});
</script>


</body>
</html>
